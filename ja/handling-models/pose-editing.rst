
モデルの基本操作
================

本節では、モデルの姿勢や位置を変更する基本的な操作方法を説明します。

説明にあたっては、 :ref:`loading_model` において紹介したPA10モデルをここでも例として用いることにしますので、
Choreonoid上で操作方法を確認する際にはこのモデルを読み込んで表示させておいてください。

関節スライダによる関節角の変更
------------------------------

ロボットの姿勢を変更する際に基本となるのは、関節角度の変更です。
これは様々な機能で実現することができますが、
まずは基本となるビューのひとつである「関節スライダビュー」を用いて関節角を変更する方法を説明します。

準備として、PA10のボディアイテムをアイテムツリービュー上で選択状態にしてください。
これで関節スライダビューの対象モデルがPA10になります。
（一旦選択しておけば、その後選択を解除してもOKです。次に他のボディアイテムが選択されるまでは、最後に選択したボディアイテムが対象であり続けます。）

すると関節スライダビューの表示が以下のようになるかと思います。

.. image:: images/jointslider_pa10_initial.png

このビューでは、最上部に表示切り替え用のボタンが並んでいます。
その下のメイン領域に、各関節の状態を表示・変更するためのインタフェースが上から関節IDの順番で並んでいます。
各関節ごとに左から、関節名、関節角現在値、最小角度、現在値のスライダ、最大角度と並んでいます。
上部の"ID"ボタンをONにすると、関節ID値も表示されます。

.. note:: ここでは関節「角度」という用語を使っていますが、これは関節が「回転関節」の場合に対応します。ロボットの多くの関節は回転関節になりますが、他に「直動関節」もあります。実際にPA10のモデルでも手先のグリッパに対応する関節 "HAND_L" と "HAND_R" は直動関節となっています。直動関節の場合、その現在位置は「角度」ではなく普通に「位置」などと呼ぶべき値になりますが、ここでは両者を含む一般的な説明には関節角度という用語をそのまま使うことにします。

ここで関節角度値やスライダ位置はユーザが変更することができ、その操作に同期してモデルの内部状態やシーンビュー上での表示も変化します。
例えば関節"J4"の値やスライダを操作してみましょう。
すると、PA10のアーム中央の関節が以下のように曲がるかと思います。

.. image:: images/pa10_j4.png

他の関節も同様に動かすことができますので、試してみてください。


シーンビュー上での関節角の変更
------------------------------

関節角の変更は、シーンビュー上で関節位置をマウスで直接ドラッグすることによっても行えます。

この操作は :doc:`../basics/index` - :doc:`../basics/sceneview` の :ref:`sceneview_editmode` で説明した「編集モード」を用いて行います。
ここの説明に従って、まずはシーンビューを編集モードに切り替えてください。
そして、マウスカーソルを先ほど操作した"J4"リンクの位置までもっていくと、以下のような表示になるかと思います。

.. image:: images/j4_drag.png

ここでPA10モデルの最下部を囲う赤いマーカーは、この部分が現在のベースリンクであることを示しています。
これはシーンビューが編集モードになった際に表示されますので、この表示によっても編集モードであることを確認することができます。
そして、J4リンクを囲う赤いボックスは、マウスカーソルがJ4リンクを指しており、編集操作の対象リンクとなっていることを示しています。
これについては、カーソルが他のリンクを指せばそちらが囲われることになります。

この状態でマウスの左ボタンを押しながらドラッグしてみてください。
するとマウスのドラッグと連動してJ4関節が動くかと思います。
このようにして、シーンビュー上で直観的に関節をドラッグし、姿勢を変更することができます。

また、シーンビュー上で関節をドラッグした場合でも、先ほどの関節スライダビューの状態が同期して変化します。
これは関節スライダビューに限らず、Bodyモデルの状態を表示・編集する全てのビューについて言えることで、
そのようなビューの動作が互いに同期することで、GUI上での一貫性が常に保たれるようになっています。

ベースリンクについて
--------------------

PA10モデルの最下部を囲っている赤いマーカーは現在のベースリンクを示していると述べました。
ここでベースリンクというのは、運動学計算の起点となるリンクのことで、ユーザが自由に変更することができます。

この効果を確認するため、PA10のベースリンクを変更してみましょう。
ベースリンクの変更は、リンクを指している状態で右クリックをすると表示されるコンテキストメニューを用いて行います。
例えばリンク"J5"をマウスカーソルで指している状態で右クリックすると下図のような表示になるかと思います。

.. image:: images/pa10_j5_tobase.png

ここでコンテキストメニューの「ベースに」を選択すると、リンク"J5"がベースリンクとなります。
ベースリンクを示す赤いマーカーもJ5の箇所に移ります。

この状態で、再度ジョイントスライダビュー等を使ってJ4の関節角度を変えてみましょう。
するとJ4の関節角が変わるのは同じなのですが、最終的な姿勢は以下のように変わるはずです。

.. image:: images/pa10_j4_inv.png

今までは固定されていたロボット最下部が今度は動くようになりました。
逆にベースリンクにしたJ5リンクの位置は固定されています。
これは関節角度から各リンクの位置を計算する順運動学計算が、ベースリンクを起点として行われるためです。

このように、ベースリンクを設定することで、姿勢において固定する部分を切り替えることができます。
PA10のようなマニピュレータでは通常床に固定される土台のリンクをベースとし、
他のリンクをベースとしたいことはあまり無いかもしれませんが、
ロボットの形態によってはベースリンクの切り替えを便利に活用することができるでしょう。
                  
モデルの移動
------------

プリセット姿勢
--------------

逆運動学による姿勢の変更
------------------------


